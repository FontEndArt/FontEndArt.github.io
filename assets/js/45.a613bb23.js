(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{254:function(t,s,n){"use strict";n.r(s);var e=n(0),a=Object(e.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"vue主线剧情之vm-render"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vue主线剧情之vm-render"}},[t._v("#")]),t._v(" Vue主线剧情之vm._render")]),t._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),n("p",[t._v("前面说过的"),n("code",[t._v("vm.$mount")]),t._v("，在 "),n("code",[t._v("new Wather")]),t._v(" 中，会调用 "),n("code",[t._v("updateComponent")]),t._v(" 方法。在这个方法中生成虚拟Node节点（vNode），最后调用 "),n("code",[t._v("vm._update")]),t._v(" 来更新Dom,那么其中最核心的就是 "),n("code",[t._v("vm._render")]),t._v(" 和 "),n("code",[t._v("vm._update")]),t._v("。")]),t._v(" "),n("p",[t._v("这里我们就来详细了解一下 "),n("code",[t._v("vm._render")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("忘了 "),n("code",[t._v("updateComponent")]),t._v(" 方法的点击这里: "),n("a",{attrs:{href:"https://github.com/vuejs/vue/blob/d9b27a92bd5277ee23a4e68a8bd31ecc72f4c99b/src/core/instance/lifecycle.js#L169-L192",target:"_blank",rel:"noopener noreferrer"}},[t._v("updateComponent"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#源码"}},[t._v("#")]),t._v(" 源码")]),t._v(" "),n("p",[t._v("emm... 不看源码就说流程的都是耍流氓。")]),t._v(" "),n("p",[t._v("_render 定义在 "),n("a",{attrs:{href:"https://github.com/vuejs/vue/blob/f64765fa03c1eb1d37f3301ea5beb4d18e57158a/src/core/instance/render.js#L69-L129",target:"_blank",rel:"noopener noreferrer"}},[t._v("src/core/instance/render.js"),n("OutboundLink")],1),t._v(" 中")]),t._v(" "),n("h2",{attrs:{id:"大概看了看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#大概看了看"}},[t._v("#")]),t._v(" 大概看了看")]),t._v(" "),n("p",[t._v("嗯～，果然不出所料，"),n("code",[t._v("vm._render")]),t._v(" 就是生成vNode了，所以我们只需要找到其中最关键的地方就行了。")]),t._v(" "),n("p",[t._v("在哪里呢？ 那就是 "),n("code",[t._v("vnode = render.call(vm._renderProxy, vm.$createElement)")]),t._v("。")]),t._v(" "),n("p",[t._v("不过后面好像还有一个 "),n("code",[t._v("renderError.call")]),t._v("， 看它的参数估摸着和render做的事情差不多。")]),t._v(" "),n("h2",{attrs:{id:"还记得vue的options吗？"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#还记得vue的options吗？"}},[t._v("#")]),t._v(" 还记得Vue的options吗？")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/vuejs/vue/blob/f64765fa03c1eb1d37f3301ea5beb4d18e57158a/src/core/instance/render.js#L71",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里是贼重要的一句"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("所以，render是从vm.$options中拿的咯。")]),t._v(" "),n("p",[t._v("让我们回到Vue.js的Api")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://vuejs.org/v2/api/#render",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://vuejs.org/v2/api/#render"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://vuejs.org/v2/api/#renderError",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://vuejs.org/v2/api/#renderError"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("你是否像这样调用过呢？")]),t._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// render")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("render")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("renderError")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("createElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pre'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" color"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// renderError")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("h")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'oops'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderError")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("h"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("h")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pre'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" style"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" color"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("$mount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br")])]),n("p",[t._v("所以结合一下就可以看出 render 方法的参数 createElement 实际上就是 vm.$createElement, 然而 vm.$createElement 在初始化中就已经执行过了。")]),t._v(" "),n("p",[t._v("具体看这里： "),n("a",{attrs:{href:"https://github.com/vuejs/vue/blob/f64765fa03c1eb1d37f3301ea5beb4d18e57158a/src/core/instance/render.js#L27-L34",target:"_blank",rel:"noopener noreferrer"}},[t._v("initRender"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("我们发现 "),n("code",[t._v("initRender")]),t._v(" 方法中，除了 "),n("code",[t._v("vm.$createElement")]),t._v(" 方法，还有一个 "),n("code",[t._v("vm._c")]),t._v(" 方法，它是被"),n("strong",[t._v("模板编译成的")]),t._v(" "),n("code",[t._v("render")]),t._v(" 函数使用，但 "),n("code",[t._v("vm.$createElement")]),t._v(" 是我们用"),n("strong",[t._v("原生写的")]),t._v(" "),n("code",[t._v("render")]),t._v(" 方法使用的， 这俩个方法支持的参数相同，并且内部都调用了 "),n("code",[t._v("createElement")]),t._v(" 方法。")]),t._v(" "),n("p",[t._v("官网说的非常清楚：")]),t._v(" "),n("blockquote",[n("p",[t._v("The render function has priority over the render function compiled from template option or in-DOM HTML template of the mounting element which is specified by the el option.")])]),t._v(" "),n("p",[t._v("也就是如果你在options配置项中传入了自己写的render函数，会优先于template和outhorHtml（in-DOM HTML template）的编译渲染功能。")]),t._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("经过一番查找，终于得到了结论， "),n("code",[t._v("render")]),t._v(" 函数最终是执行 "),n("code",[t._v("createElement")]),t._v(" 方法，返回 "),n("code",[t._v("vnode")]),t._v(" 节点，这是一个虚拟 "),n("code",[t._v("node")]),t._v("。")]),t._v(" "),n("blockquote",[n("p",[t._v("阿西吧  终于提到了虚拟dom的概念了。。。  感觉有盼头了")])]),t._v(" "),n("p",[t._v("Vue的另一个核心就是用到了Virtual DOM，实际上是借鉴了开源库 "),n("a",{attrs:{href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"}},[t._v("snabbdom"),n("OutboundLink")],1),t._v(" 的实现，然后加入了一些自己的东西。")]),t._v(" "),n("p",[t._v("接下来我们将继续追寻 "),n("code",[t._v("createElement")]),t._v(" 方法。")]),t._v(" "),n("hr"),t._v(" "),n("p",[t._v("两个扩展问题：")]),t._v(" "),n("ul",[n("li",[t._v("操作 "),n("code",[t._v("Virtual DOM")]),t._v(" 快还是真实 "),n("code",[t._v("DOM")]),t._v(" 快？")]),t._v(" "),n("li",[t._v("Vue的Dom diff你了解多少？ (好像在这里问不太合适，算了，先问了再说)")])])])}),[],!1,null,null,null);s.default=a.exports}}]);